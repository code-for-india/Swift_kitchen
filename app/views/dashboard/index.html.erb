
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
<div style=''>
  <div id="map" style='height: 600px;'></div>
    <div id="directions_panel" style="margin:20px;background-color:#FFEE77;"></div>
</div>
<script type="text/javascript">
/*var directionsService = new google.maps.DirectionsService();
var handler = Gmaps.build('Google');
markers1 = <%=raw @hash.to_json %>;
handler.buildMap({ internal: {id: 'map'}}, function(){
  var markers = handler.addMarkers(markers1);
  handler.bounds.extendWith(markers);
  handler.fitMapToBounds();
});*/

var directionsDisplay;
var directionsService = new google.maps.DirectionsService();
var map;

function initialize() {
  directionsDisplay = new google.maps.DirectionsRenderer();
  map = new google.maps.Map(document.getElementById('map'));
  directionsDisplay.setMap(map);
  var srcJson = <%=raw @kitchen.to_json%>
  var waypointsJson = <%=raw @waypoints.to_json%>
  var start = srcJson["latitude"]+","+srcJson["longitude"];
  var waypts = [];
  for (var i = 0; i < waypointsJson.length; i++) {
      waypts.push({
          location:waypointsJson[i]["lat"]+","+waypointsJson[i]["lng"],
          stopover:true});

  }


    var request = {
      origin: start,
      destination: start,
      waypoints: waypts,
      optimizeWaypoints: true,
      travelMode: google.maps.TravelMode.DRIVING
  };

  directionsService.route(request, function(response, status) {
    if (status == google.maps.DirectionsStatus.OK) {
      directionsDisplay.setDirections(response);

	  var route = response.routes[0];
	  console.log(route)
	  var summaryPanel = document.getElementById('directions_panel');
	  summaryPanel.innerHTML = '';
	      // For each route, display summary information.
	      for (var i = 0; i < route.legs.length; i++) {
	        var routeSegment = i + 1;
	        summaryPanel.innerHTML += '<b>Route Segment: ' + routeSegment + '</b><br>';
	        summaryPanel.innerHTML += route.legs[i].start_address+'</b><br>';

	        summaryPanel.innerHTML += route.legs[i].distance.text + '<br><br>';
	      }
		}
	});

}
google.maps.event.addDomListener(window, 'load', initialize); 


/*$.ajax({
	url:'/optimizeRoute',
	success:function(data){
      directionsDisplay.setDirections(data);
      var route = data.routes[0];
      console.log(route)
      var summaryPanel = $('#directions_panel');
      summaryPanel.val('');
      for (var i = 0; i < route.legs.length; i++) {
        var routeSegment = i + 1;
        summaryPanel.innerHTML += '<b>Route Segment: ' + routeSegment + '</b><br>';
        summaryPanel.innerHTML += route.legs[i].start_address + ' to ';
        summaryPanel.innerHTML += route.legs[i].end_address + '<br>';
        summaryPanel.innerHTML += route.legs[i].distance.text + '<br><br>';
      }
      // For each route, display summary information.
	}
});*/
</script>
